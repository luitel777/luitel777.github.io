<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reading assembly so you can live without fear</title>
  
  
  <meta name="author" content="map[name:Aagaman Luitel]">
  <link id="pagestyle" rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" id="switcher-id" href="">
  
</head>

<body>
  <header>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=1.0, minimum-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="Aagaman Luitel's spaceship">
  <meta name="author" content="Aagaman Luitel">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <meta charset="UTF-8">
  <div class="site_title_index">
    <a href="https://luitelaagaman.com.np/">Aagaman Luitel</a>
  </div>
  
</header>

  
<link rel="stylesheet" href="/css/single.css">


<button class="theme_changer" onclick="theme_switch()">
  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="24" viewBox="0 0 24 24" fill="none" color="#0fdb1a"
    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-zap">
    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
  </svg>
</button>


<nav class="url_nav_bar" id="url_nav_bar">
  <a rel="nofollow" href="/about">Contact</a>
  <a rel="nofollow" href="/writings">Writings</a>
  <a rel="nofollow" href="/thoughts">Thoughts</a>
</nav>

<script>
  if (localStorage.getItem("darkmode") === "nosir") {
    document.getElementById('switcher-id').href = '/css/light.css';
  } else {
    document.getElementById('switcher-id').href = '/css/dark.css';
  }

  function theme_switch() {
    if (localStorage.getItem("darkmode") === "nosir") {
      document.getElementById('switcher-id').href = '/css/dark.css';
      localStorage.setItem("darkmode", "yessir")
    } else {
      document.getElementById('switcher-id').href = '/css/light.css';
      localStorage.setItem("darkmode", "nosir")
    }
  }
</script>

<main>
  <article>

    <div class="single_main">
      <div class="single_heading">
        <h1>Reading assembly so you can live without fear</h1>
        Aagaman Luitel | words: 938 | 4 minutes |
        <time datetime=" 2022-12-23">2022.12.23</time>
        <hr>
      </div>
      <div>
        <p>Compilers are smart these days. You don&rsquo;t have to learn assembly but knowing
them will certainly help anyone to see what the compiler is doing. I believe
you learn assembly by referencing. There are so many opcodes/instructions that
one might go crazy remembering them all. My preferred way is using spooky
internet to look up the opcodes you don&rsquo;t know. The referencing method. There
are so many things one need to know to program assembly but understanding basic
compiler generated assembly needs mostly reference and assumptions.</p>
<h2 id="a-simple-assembly-instruction">A simple assembly instruction</h2><p>Assembly language are made of small instructions that do specific things
which makes writing assembly complicated. There are various assembly language
but most of them are similar. A CPU implements instruction set architecture
(ISA). ISA is a binary format specifiying how an instruction should look like.
Assembler implements the ISA, and the implmenetation syntax might differ from
assembler to assembler.</p>
<p>Syntax of assembly depends on the assembler
They are either
<code>&lt;opcode&gt; destination, source</code>
or
<code>&lt;opcode&gt; source, destination</code></p>
<p>I&rsquo;ve tried looked at clang generated assembly and nasm assembly and they both use <code>&lt;opcode&gt; destination, source</code> format</p>
<h3 id="registers">Registers</h3><p>CPU have registers. They store things temporarily like memory address and
instructions. One can move things in registers by <code>mov rax, 2</code>. This copies 2 to
rax register. There are also other ways of storing in assembly. Lets take
example of x86_64 asm generated by clang which uses rbp registers like: <code>mov dword ptr[rbp - 4], 77</code>. It simply takes rbp stack, allocates 4 bytes for our integer
77 and copies 77 there. Similarly for another variable of lets say long int (8
bytes) the instruction set will be <code>mov dword[rbp - 12], 782</code>. It
allocates 8 bytes futher after <code>[rbp-4]</code>.</p>
<h3 id="instructions">Instructions</h3><p>These are opcodes/instructions. If you want to add two register simply do <code>add register1, register2</code>.</p>
<p>Some instructions <a href="https://wiki.cdot.senecacollege.ca/wiki/X86_64_Register_and_Instruction_Quick_Start">https://wiki.cdot.senecacollege.ca/wiki/X86_64_Register_and_Instruction_Quick_Start</a></p>
<h3 id="general-purpose-registers">General purpose registers</h3><p>Some registers you will often see are rax, rbx, rcx and so on.<!-- raw HTML omitted -->
rax is 64 bit opcode so rax in 32 bit mode will be eax, ax in 16 bit and so on.</p>
<p>You can find more on <a href="http://www.egr.unlv.edu/~ed/assembly64.pdf">http://www.egr.unlv.edu/~ed/assembly64.pdf</a> [ASM]</p>
<p>64bit register contains 8 bytes so $2^8 = 64$ bits</p>
<p>so 60 in rax would be</p>
<p>00000000 00000000 00000000 00000000 00000000 00000000 00000000 0011110</p>
<p>Msb is leftmost bit</p>
<p>This is eax would be</p>
<p>00000000 00000000 00000000 00111100</p>
<p>This is ax is</p>
<p>00000000 00111100</p>
<p>This in al is</p>
<p>00111100</p>
<h3 id="types">Types</h3><p>Assembly does not have type saftey. Only signed and unsigned numbers</p>
<p>Signed -&gt; Use imul or idiv</p>
<p>Unsigned -&gt; Use mul or div</p>
<h3 id="example-code">Example code</h3><p>Here we are doing simple demonstration of computing 2^16 using bit shift. This
is not the actual INT_MAX since size of int is 4 bytes in C and not 2 unless
you are using very old compiler.</p>

  
    
  


<div class="highlight"><div style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span><span style="color:#feacd0">extern</span> printf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#feacd0">section</span> .data
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">count</span> db &#34;INT_MAX is <span style="color:#00d3d0">%d</span>&#34;, <span style="color:#00bcff">10</span>, <span style="color:#00bcff">0</span> <span style="color:#a8a8a8">; define a string to pass to printf
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span><span style="color:#feacd0">section</span> .text
</span></span><span style="display:flex;"><span><span style="color:#feacd0">global</span> main
</span></span><span style="display:flex;"><span>main:
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">push</span> rbp    <span style="color:#a8a8a8">; set up stack
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">jmp</span> power   <span style="color:#a8a8a8">; jump to power section 
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>		            <span style="color:#a8a8a8">; code below will not be executed unless
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>		            <span style="color:#a8a8a8">; it has jump condition to main
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>		
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">pop</span> rbp     <span style="color:#a8a8a8">; remove rbp stack and return
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>		<span style="color:#feacd0">ret</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>power:
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">mov</span> rax, <span style="color:#00bcff">1</span>  <span style="color:#a8a8a8">; put 1 in rax register
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">sal</span> rax, <span style="color:#00bcff">16</span> <span style="color:#a8a8a8">; shift arithmetic left rax and 16 (1 &lt;&lt; 16)
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">mov</span> rdi, count <span style="color:#a8a8a8">; 1st argument for printf in rdi
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>		<span style="color:#feacd0">mov</span> rsi, rax <span style="color:#a8a8a8">; and next 2nd argument in rsi which is rax (1 &lt;&lt; 16)
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">call</span> printf <span style="color:#a8a8a8">; and call printf
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>		<span style="color:#feacd0">pop</span> rbp <span style="color:#a8a8a8">; remove the rbp stack
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>		<span style="color:#feacd0">ret</span> ; return</span></span></code></pre></td></tr></table>
</div>
</div>

<script>
function copy(){
}
</script>

<style>
  .custom_code_block_title{    
    background-color: var(--text);
    color: var(--background-color);
  }
  .code_copy_block {
    background-color: var(--text);
    color: var(--background-color);
    margin-left: 80%;
    border: none;
    padding: 0;
    cursor: pointer;
    font: inherit;
    outline: inherit;
  }
</style>
<p>Equivalent C code.</p>
<p>Compiler is smart enough to evaluate 1 &laquo; 16 and replace with 65536 if we hardcode 1 &laquo; 16 in printf without declaring variables. So we write C code like this for our purposes.</p>

  
    
  


<div class="highlight"><div style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#a8a8a8">#include</span> <span style="color:#a8a8a8">&lt;stdio.h&gt;</span><span style="color:#a8a8a8">
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span><span style="color:#6ae4b9">int</span> <span style="color:#feacd0">main</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#6ae4b9">int</span> a <span style="color:#00d3d0">=</span> <span style="color:#00bcff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#6ae4b9">int</span> b <span style="color:#00d3d0">=</span> <span style="color:#00bcff">16</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">printf</span>(<span style="color:#79a8ff">&#34;INT_MAX is %d</span><span style="color:#79a8ff">\n</span><span style="color:#79a8ff">&#34;</span>, a <span style="color:#00d3d0">&lt;&lt;</span> b);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></td></tr></table>
</div>
</div>

<script>
function copy(){
}
</script>

<style>
  .custom_code_block_title{    
    background-color: var(--text);
    color: var(--background-color);
  }
  .code_copy_block {
    background-color: var(--text);
    color: var(--background-color);
    margin-left: 80%;
    border: none;
    padding: 0;
    cursor: pointer;
    font: inherit;
    outline: inherit;
  }
</style>
<p>Again, compiling to assembly with x86-64 clang you will see lots of similarity with our previous assembly snippet.</p>

  
    
  


<div class="highlight"><div style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#fff;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-asm" data-lang="asm"><span style="display:flex;"><span>main: <span style="color:#a8a8a8"># @main
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>    <span style="color:#a8a8a8">; setting up the stack
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	<span style="color:#feacd0">push</span> rbp
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">mov</span> rbp, rsp
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">sub</span> rsp, <span style="color:#00bcff">16</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">mov</span> dword ptr [rbp - <span style="color:#00bcff">4</span>], <span style="color:#00bcff">1</span>      <span style="color:#a8a8a8">; copy 1 to [rbp - 4] stack
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>			                <span style="color:#a8a8a8">; rbp is stack pointer. This instruction is 
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	                                <span style="color:#a8a8a8">; declaring int &#39;a&#39; offset of 4 bytes from rbp
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	                                <span style="color:#a8a8a8">; int is 4 bytes. long int would make this [rbp - 8]
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">mov</span> dword ptr [rbp - <span style="color:#00bcff">8</span>], <span style="color:#00bcff">16</span>    <span style="color:#a8a8a8">; same is happening here 4 bits for int &#39;b&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">mov</span> esi, dword ptr [rbp - <span style="color:#00bcff">4</span>]   <span style="color:#a8a8a8">; move a to esi register 1
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	<span style="color:#feacd0">mov</span> ecx, dword ptr [rbp - <span style="color:#00bcff">8</span>]   <span style="color:#a8a8a8">; move b to exc register 16
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">shl</span> esi, cl	                <span style="color:#a8a8a8">; cl is 8 bit opcode for ecx
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>                                   	<span style="color:#a8a8a8">; no idea why its used like this
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	                                <span style="color:#a8a8a8">; anyway this is just shift left 1, 16 (1 &lt;&lt; 16)
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">movabs</span> rdi, offset .L.str      <span style="color:#a8a8a8">; this might be doing some cleanup
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	<span style="color:#feacd0">mov</span> al, <span style="color:#00bcff">0</span>
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">call</span> printf                    <span style="color:#a8a8a8">; calls printf
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	<span style="color:#feacd0">xor</span> eax, eax                   <span style="color:#a8a8a8">; sets eax to 0. xor same value gives 0
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>
</span></span><span style="display:flex;"><span>	<span style="color:#a8a8a8">; closing the stack
</span></span></span><span style="display:flex;"><span><span style="color:#a8a8a8"></span>	<span style="color:#feacd0">add</span> rsp, <span style="color:#00bcff">16</span>
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">pop</span> rbp
</span></span><span style="display:flex;"><span>	<span style="color:#feacd0">ret</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.L.str:
</span></span><span style="display:flex;"><span>	.asciz <span style="color:#79a8ff">&#34;INT_MAX is %d\n&#34;</span></span></span></code></pre></td></tr></table>
</div>
</div>

<script>
function copy(){
}
</script>

<style>
  .custom_code_block_title{    
    background-color: var(--text);
    color: var(--background-color);
  }
  .code_copy_block {
    background-color: var(--text);
    color: var(--background-color);
    margin-left: 80%;
    border: none;
    padding: 0;
    cursor: pointer;
    font: inherit;
    outline: inherit;
  }
</style>
<h2 id="some-resources-to-get-your-hand-dirty">Some Resources to get your hand dirty</h2><ul>
<li><a href="https://www.intel.com/content/dam/develop/external/us/en/documents/introduction-to-x64-assembly-181178.pdf">https://www.intel.com/content/dam/develop/external/us/en/documents/introduction-to-x64-assembly-181178.pdf</a> [ASM x86_64]</li>
<li><a href="https://youtu.be/L1ung0wil9Y">https://youtu.be/L1ung0wil9Y</a> [ASM]</li>
<li><a href="https://refspecs.linuxbase.org/elf/x86_64-abi-0.99.pdf">https://refspecs.linuxbase.org/elf/x86_64-abi-0.99.pdf</a> [System V ABI]</li>
<li><a href="http://www.egr.unlv.edu/~ed/assembly64.pdf">http://www.egr.unlv.edu/~ed/assembly64.pdf</a> [ASM]</li>
<li><a href="https://linasm.sourceforge.net/docs/instructions">https://linasm.sourceforge.net/docs/instructions</a> [ASM]</li>
<li><a href="https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/">https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/</a> [Linux syscalls]</li>
<li><a href="https://c9x.me/articles/gthreads/mach.html">https://c9x.me/articles/gthreads/mach.html</a> [Article]</li>
<li><a href="https://www.nayuki.io/page/a-fundamental-introduction-to-x86-assembly-programming">https://www.nayuki.io/page/a-fundamental-introduction-to-x86-assembly-programming</a> [Article]</li>
<li><a href="https://github.com/pkivolowitz/asm_book">https://github.com/pkivolowitz/asm_book</a> [Github]</li>
<li><a href="https://stackoverflow.com/a/40934959">https://stackoverflow.com/a/40934959</a></li>
</ul>

      </div>
    </div>


    
    <script src="/js/single_toc.js"></script>

    <div class="single_toc">
      <details open>
        <summary>Outline</summary>
        <aside>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#a-simple-assembly-instruction">A simple assembly instruction</a>
      <ul>
        <li><a href="#registers">Registers</a></li>
        <li><a href="#instructions">Instructions</a></li>
        <li><a href="#general-purpose-registers">General purpose registers</a></li>
        <li><a href="#types">Types</a></li>
        <li><a href="#example-code">Example code</a></li>
      </ul>
    </li>
    <li><a href="#some-resources-to-get-your-hand-dirty">Some Resources to get your hand dirty</a></li>
  </ul>
</nav>
        </aside>
      </details>
      
    </div>

    

  </article>
</main>
<aside>
	<div class="thoughts">
		<div>
			<h3>LATEST THOUGHTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/thoughts/pcp/">Producer Consumer Problem</a></li>
				
				<li><a href="/thoughts/workflow/">workflow changes</a></li>
				
				<li><a href="/thoughts/kafka/">Franz Kafka</a></li>
				
			</ul>
		</div>
	</div>
</aside>

  <footer>
	<p>&copy; 2024 <a href="https://luitelaagaman.com.np/">Aagaman Luitel</a></p>
</footer>

</body>

</html>
